# 業務時間計測・管理システム (Zimmeter) 要件定義書

**Version**: 2.0
**Date**: 2024-12-18

## 1. プロジェクト概要

### 1.1 システム名
業務時間計測・統合管理システム (Zimmeter)

### 1.2 目的
業務時間の正確な計測による「業務の見える化」、および厳格なユーザー管理権限による統制を行う。
管理者が全ユーザーのリアルタイムな稼働状況や過去の履歴を把握し、適正な業務管理を実現することを目的とする。

### 1.3 運用・技術環境
*   **Frontend**: React (Vite) + Tailwind CSS
*   **Backend**: Node.js + Express
*   **Database**: PostgreSQL + Prisma
*   **Container**: Docker & Docker Compose

---

## 2. 機能要件

### 2.1 ユーザー機能 (General User)
1.  **業務ログ計測**
    *   タスク（カテゴリ）を選択して業務を開始・切り替え・終了できる。
    *   現在進行中のタスクの経過時間をリアルタイムで表示。
    *   退社（業務終了）ボタンによる一日の締め処理。
    *   **離席モード**: 一定時間操作がない場合や手動で離席状態にする機能（実装状況による）。
2.  **履歴確認・修正**
    *   自身の日次、週次、月次の業務履歴をグラフおよびリストで確認できる。
    *   過去のログの修正（時間、カテゴリ）が可能。修正履歴は保持される。
    *   ログの手動追加が可能。
3.  **カテゴリ管理 (Custom)**
    *   自分専用の業務カテゴリ（Customタイプ）を作成・編集・論理削除できる。
    *   表示順序の並び替えが可能。
    *   色設定（背景色、枠線色）のカスタマイズが可能。
4.  **設定**
    *   カテゴリボタンの表示順序や非表示設定を保存できる。

### 2.2 管理者機能 (Admin)
1.  **全ユーザー監視 (Monitor)**
    *   **リアルタイムモニタリング**: 全ユーザーの現在のステータス（勤務中、退社済、未退社など）と直近のアクティビティを一覧表示。
    *   **フィルタリング**: 日次、週次、月次、カスタム期間での絞り込み。
    *   **ユーザー絞り込み**: 特定のユーザーまたは複数ユーザーを選択して表示。
2.  **業務分析・レポート**
    *   **CSVエクスポート**: 期間とユーザーを指定して詳細な業務ログをCSV形式でダウンロード可能。
    *   **PDFエクスポート**: 日報として当日の業務履歴をPDF形式でダウンロード可能。
    *   **グラフ分析**: ユーザーごとの業務割合を円グラフ、バーチャートで可視化。
    *   **チャート拡大表示**: チャートの詳細を確認するための拡大プレビュー機能。
3.  **ユーザー管理**
    *   ユーザーの新規登録（ID、パスワード、氏名、権限）。
    *   ユーザー情報の編集（氏名、権限、時給設定など）。
    *   ユーザーステータスの変更（ACTIVE, DISABLED, DELETED）。
        *   **DISABLED**: ログイン不可、画面ロック。
        *   **DELETED**: 論理削除（ログイン不可、データ保持）。
4.  **システムカテゴリ管理**
    *   全ユーザー共通の業務カテゴリ（Systemタイプ）を作成・編集・削除できる。

---

## 3. 非機能要件

### 3.1 ユーザビリティ
*   **レスポンシブデザイン**: PCおよびタブレットでの利用を想定したUI。
*   **直感的な操作**: タスク切り替えはワンクリックで行えること。
*   **フィードバック**: アクション（保存、削除、エラー等）に対し、Toast通知でフィードバックを行う。

### 3.2 信頼性・保全性
*   **履歴の改変防止 (スナップショット)**: カテゴリ名が変更されても、過去のログには記録時点の名称が保持されること。
*   **論理削除**: ユーザーやカテゴリの削除は論理削除とし、過去データの整合性を維持する。
*   **バリデーション**: 不正な日付範囲や入力値に対するチェックを行う。

### 3.3 セキュリティ
*   **認証・認可**: ログイン認証およびRoleベースのアクセス制御（RBAC）。
    *   一般ユーザーは他人のログや個人情報にアクセスできない。
    *   管理者のみが管理機能にアクセス可能。
*   **ステータスガード**: 無効化または削除されたユーザーは即座に操作がブロックされる（画面ロック）。

---

## 4. データベース要件

### 4.1 データモデル
*   **User**: ユーザー情報、権限、ステータス。
*   **UserSetting**: ユーザーごとのUI設定（ボタン順序など）。
*   **Category**: 業務項目マスタ（System/Custom）。
*   **WorkLog**: 業務実績ログ（スナップショット機能付き）。
*   **DailyStatus**: 日次の勤務状態（退社フラグ、補正フラグ）。

### 4.2 重要なデータロジック
*   **Category Name Snapshot**: `WorkLog`作成時に`Category`の名称をコピーし、マスタ変更の影響を受けないようにする。
*   **Daily Status**: ユーザーの「退社」状態を日次で管理し、翌日のステータス判定や「未退社」判定に使用する。
